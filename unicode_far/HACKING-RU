ПРАВИЛА
~~~~~~~

Предложение исправлений
~~~~~~~~~~~~~~~~~~~~~~~
Прежде всего, ознакомьтесь, пожалуйста, с нашими правилами и системой
компиляции и сборки Far'а. При внесении изменений в исходный код,
пожалуйста, следуйте следующим правилам:
1. Каждое изменение должно быть логически завершенным и, по возможности,
   минимальным. Это позволит нам быстрее его проверить и внести в исходный код.
2. Придерживайтесь единообразного стиля оформления кода.
3. Детально опишите, что и зачем Ваш код исправляет.
4. Если Ваше исправление требует обновления документации (справки,
   Энциклопедии и т.п.), не забудьте и ее обновить.
5. Исправления принимаются в виде diff-файлов, наилучший а также самый простой
   метод для создания патча является:
   svn diff > file.diff
   Пожалуйста, формируйте diff-файлы на основе последних версий исходного кода.
6. Прежде чем прислать нам Ваше исправление, загляните в файл MAINTAINERS.
   В нем перечислены люди, отвечающие за внесение изменений в определенную
   часть Far'а. Определитесь, кто должен получить Ваше обновление и каким
   способом этот человек предпочитает его получить. Все исправления должны
   отправляться либо по электронной почте, либо через Mantis. Вы должны
   получить ответ в течение десяти дней.
7. Если Вы планируете вносить большие исправления или просто желаете находится
   в курсе последних событий в разработке Far'а, подпишитесь на нашу рассылку:
   http://groups.google.com/group/fardev (fardev@googlegroups.com).
8. Если Вы будете присылать нам исправления часто и хорошего качества,
   Вам будет предоставлен полный доступ к SVN, на наше усмотрение.
9. Пожалуйста, будьте снисходительны - мы сами новички в Open Source :)


Сборка
~~~~~~
1. Для сборки с помощью VC есть набор батников:

   Эти батники на прямую не редактировать!!!!!!!!!
   Только для постоянных изменений для всех участников проекта.
   Читайте объяснение - всё продумано.

   --------------------
   vc.build.release.bat
   --------------------
   Этот батник собирает release версию фара с помощью VC и Far.mak.
   Батник заодно обновляет far.release.dep и языковые файлы.
   С запуском этого батника никогда не будут никаких проблем при сборке фара
   (кроме ошибок в самом коде :).
   Чтобы батник был универсальным и работал у всех без изменений, он
   вызывает другой батник - custom.vc.release.bat - если такой есть.
   Этот (custom.vc.release.bat) батник вам надо создать самим, так как он ваш
   личный и на SVN комитится не будет. В нём вы можете определять переменные
   среды компайлера и переопределять переменные среды которые используются
   для сборки фара в главном батнике.
   Например у меня он содержит:
   ---->8----
   @echo off
   set NMAKE_OPTS=USE_VC8_32=1
   call "C:\Program Files\Microsoft SDKs\Windows\v6.0\Bin\SetEnv.Cmd" /Release /x86 /xp
   ----8<----

   ------------------
   vc.build.debug.bat
   ------------------
   Тоже что и vc.build.release.bat только собирает debug версию, обновляет
   far.debug.dep и вызывает custom.vc.debug.bat если такой есть.
   Пример custom.vc.debug.bat:
   ---->8----
   @echo off
   set NMAKE_OPTS=USE_VC8_32=1
   call "C:\Program Files\Microsoft SDKs\Windows\v6.0\Bin\SetEnv.Cmd" /Debug /x86 /xp
   set FARSYSLOG=-DSYSLOG_TREX %FARSYSLOG%
   ----8<----

   Тоже самое и для x64 сборки тока с
   vc.build.debug.64.bat --> custom.vc.debug.64.bat
   vc.build.release.64.bat --> custom.vc.release.64.bat

   Если в качестве линкера хочется использовать ulink, то в custom.vc...bat
   нужно включить строку:
   ---->8----
   set NMAKE_OPTS=LINK_ULINK=1
   ----8<----
   или (для 32хбитовых версий, компилируемых VC8)
   ---->8----
   set NMAKE_OPTS=USE_VC8_32=1 LINK_ULINK=1
   ----8<----

   При использовании VC9(VS2008) в custom.vc...bat нужно включить строку:
   ---->8----
   set NMAKE_OPTS=USE_VC9=1
   ----8<----
   
   Через задание NMAKE_OPTS можно передавать также и ключи nmake.


2. Для сборки GCC есть мэйк файл, makefile_gcc, который всё делает.
   Для примера, чтоб собрать с Mingw выполните следующею команду:
   mingw32-make -f makefile_gcc


Описание изменений - файл "changelog"
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. Все комментарии по внесенным изменениям пишутся в файл "changelog".
   В сорцах имеет смысл оставлять комментарии только если участок с вашей
   точки зрения будет непонятен для "будущих поколений".
2. Дописываем изменения в начало файла.
3. Каждая запись начинается с шапки вида:
   warp 05.12.2006 01:39:38 +0300 - build 2149
4. Изменениям может не присваиваться билд, например, была косметика или
   изменения не в коде.


farversion.m4
~~~~~~~~~~~~~
1. Этот файл содержит информацию для генерации версии фара:
   a. BUILDTYPE, строка определяющая тип сборки, может быть:
      - `'      - пустая строка обозначает релиз
      - `alpha' - альфа версия
      - `beta'  - бета версия
      - `RC'    - релиз кандидат
      - `ЧтоЛибоДругое' - предназначено для выпуска версий фара,
        код которых ещё не вошел в SVN, чтоб не путать людей и нас.
        Вывод версии фара будет выглядеть следующим образом:
        ВерсияФара alpha ЧтоЛибоДругое based on build НомерБилда
   b. BUILDTESTONLY, флаг для вывода TEST ONLY! в версии. Может быть 1 или 0.
   c. BUILDTYPENUM, номер сборки - будет выводится для alpha,beta,RC версий.
   d. MAJOR - MAJOR версия фара (например 1).
   e. MINOR - MINOR версия фара (например 71).


vbuild.m4
~~~~~~~~~
1. Если в файле "vbuild.m4" был изменен номер билда, то после коммита
   изменений необходимо запустить "svn_tag_build.bat".


Исключения
~~~~~~~~~~
1. Вместо _try __try и т.п. применяем макрос TRY
2. Вместо __except и т.п. применяем макрос EXCEPT


GCC - обеспечение "удачной" компиляции под GCC
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. Вместо постфиксов i64 и ui64 используем макро _i64() и _ui64().


x64 - обеспечение "удачной" работы под x86 и x64
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. DWORD_PTR, LONG_PTR, etc. применяется вместо DWORD/long/etc. в следующих
   случаях:

   a) нужны там где раньше были int/long/dword/или_любой_не_поинтер_тип_даных
      и в него пихали поинтер
   b) ...
   c) ...


REMINDER
~~~~~~~~
В файле "REMINDER" необходимо заносить сведения, на которые стоит обратить
внимание (или после некоторых действий "вернуться" к некоторому начальному
состоянию).
